<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å¤–éƒ¨å‘ã‘ãƒ»å•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆé€ä¿¡ã®ã¿ï¼‰</title>
  <style>
    :root{--bg:#f7f8f9;--panel:#ffffff;--border:#e0e4ea;--text:#222;--sub:#666;--accent:#06C755;--accent-light:#d6f5dd;}
    html,body{margin:0;padding:0;background:var(--bg);font-family:"Hiragino Sans","Noto Sans JP",system-ui,sans-serif;color:var(--text);-webkit-text-size-adjust:100%;}
    .container{max-width:640px;margin:0 auto;padding:20px 16px 60px;}
    h1{font-size:20px;margin-bottom:12px;text-align:center;color:#111;}
    .badge{display:inline-block;background:var(--accent-light);color:var(--accent);font-size:13px;padding:4px 10px;border-radius:999px;font-weight:600;margin:0 auto 20px;}
    .section{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:18px 16px;margin-bottom:16px;box-shadow:0 1px 3px rgba(0,0,0,.05);}
    .section h3,.section h4{margin-top:0;font-size:16px;margin-bottom:12px;border-left:4px solid var(--accent);padding-left:8px;color:#111;}
    label{font-weight:600;font-size:14px;color:#222;}
    .req{color:#e54848;}
    .field{display:flex;flex-direction:column;gap:6px;margin-bottom:14px;}
    input[type="text"],input[type="number"],input[type="date"],input[type="url"],input[type="datetime-local"],textarea,select{width:100%;padding:12px 14px;border-radius:8px;border:1px solid var(--border);background:#fff;color:#222;font-size:15px;box-sizing:border-box;}
    textarea{min-height:100px;resize:vertical;}
    .mini{font-size:12.5px;color:var(--sub);line-height:1.5;}
    .buttons{display:flex;flex-direction:column;gap:10px;margin-top:8px;}
    button{font-size:16px;font-weight:600;border-radius:8px;padding:14px;cursor:pointer;border:none;transition:.2s ease;}
    button.primary{background:var(--accent);color:#fff;}
    button.primary:hover{background:#05b54e;}

    /* ã‚«ãƒ¼ãƒ‰UI / è¦‹ãŸç›®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆè‡ªå‹•ï¼‰ */
    .sample-container{display:flex;flex-wrap:wrap;gap:12px;margin-top:10px;}
    .sample-card{width:200px;border-radius:12px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,0.08);overflow:hidden;border:1px solid #e0e0e0;font-size:13px;}
    .sample-card img{width:100%;height:120px;object-fit:cover;}
    .sample-card .sample-body{padding:8px 10px 12px;}
    .sample-card .title{font-weight:600;margin:4px 0;color:#222;}
    .sample-card .desc{color:#555;font-size:12px;line-height:1.4;}
    .sample-card .tag{background:#555;color:#fff;font-size:11px;border-radius:6px;padding:2px 6px;display:inline-block;}
    .sample-card .buttons{border-top:1px solid #eee;}
    .sample-card .btn{text-align:center;color:#06c755;padding:6px;font-weight:600;cursor:pointer;}
    .sample-card .price{text-align:right;color:#222;font-weight:600;}

    .coupon-card-container{display:flex;flex-direction:column;gap:12px;margin-top:14px;}
    .coupon-card{border:1px solid var(--border);background:#fff;border-radius:10px;padding:16px 18px;box-shadow:0 2px 6px rgba(0,0,0,.05);cursor:pointer;transition:.2s;}
    .coupon-card.active{border-color:var(--accent);background:var(--accent-light);box-shadow:0 0 0 2px rgba(6,199,85,0.2);}
    .coupon-settings{background:#fff;border-radius:12px;padding:18px 16px 22px;border:1px solid var(--border);margin-top:16px;box-shadow:0 1px 3px rgba(0,0,0,.05);}
    .coupon-settings .grid{display:flex;flex-direction:column;gap:14px;}
    .coupon-settings input,.coupon-settings textarea,.coupon-settings select{font-size:15px;padding:12px 14px;border-radius:8px;border:1px solid var(--border);background:#fdfdfd;}
    .grid{display:flex;flex-direction:column;gap:10px;}
    @media (min-width:720px){.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;}}
    .card{background:#fff;border:1px solid var(--border);border-radius:10px;padding:12px;box-shadow:0 2px 6px rgba(0,0,0,.05);margin-bottom:10px;}

    /* ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
    .rm-map{position:relative;display:flex;justify-content:center;align-items:center;width:100%;margin:12px 0;}
    .rm-map img{display:block;width:100%;max-width:320px;height:auto;border-radius:12px;border:1px solid var(--border);box-shadow:0 2px 6px rgba(0,0,0,0.08);object-fit:contain;pointer-events:none;}
    .rm-hot{position:absolute;cursor:pointer;background:transparent;transition:background .2s;z-index:10;}
    .rm-hot.active{background:rgba(6,199,85,0.25);border-radius:4px;}
    .legend{display:flex;flex-wrap:wrap;gap:6px 12px;font-size:12px;color:var(--sub);margin-top:8px;}
    .legend .key::before{content:"â–  ";color:var(--accent);}
    .local-actions{position:sticky;bottom:-8px;background:#fff;padding:12px 0 4px;border-top:1px solid var(--border);display:flex;gap:10px;z-index:5;}
    .local-actions .tip{margin-left:auto;font-size:12px;color:var(--sub);align-self:center;}

    /* sec-card å†…è£…é£¾ */
    #sec-card .card{background:#fff;border:1px solid var(--border);border-radius:12px;padding:18px 16px 20px;box-shadow:0 2px 5px rgba(0,0,0,.05);margin-bottom:18px;}
    #sec-card .subfields,#sec-card .two{background:#f9fafb;border-radius:8px;padding:10px 12px 12px;margin-top:10px;border:1px solid #e9edf3;}
    #sec-card input[type="file"]{background:#fff;padding:10px;border-radius:6px;border:1px solid #ccc;}
    #sec-card .two{display:flex;flex-direction:column;gap:12px;}
    @media (min-width:720px){#sec-card .two{flex-direction:row;}}

    /* ã‚·ãƒ§ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰ï¼šã‚«ãƒ©ãƒ¼é¸æŠï¼ˆ12è‰²ï¼‰ */
    .color-samples{display:grid;grid-template-columns:repeat(auto-fit, minmax(80px, 1fr));gap:8px;}
    .color-box{background:var(--c);padding:12px 0;text-align:center;border-radius:8px;color:#fff;font-weight:600;font-size:13px;border:1px solid rgba(0,0,0,.1);cursor:pointer;user-select:none;}
    .color-box span{font-size:11px;display:block;opacity:.8;}
    .color-box.selected{outline:2px solid var(--accent);outline-offset:2px;}

    /* ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼å¼·èª¿ */
    .card.highlight{box-shadow:0 0 0 3px rgba(6,199,85,0.4) !important;transition:box-shadow .3s ease;}
  </style>
</head>
<body>
  <div class="container">
    <div class="kicker">
      <h1>å•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆå¤–éƒ¨ã®ãŠå®¢æ§˜å‘ã‘ï¼‰</h1>
      <span class="badge">é€ä¿¡ã®ã¿ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ãªã—ï¼‰</span>
    </div>

    <!-- â‘  åŸºæœ¬æƒ…å ± -->
    <div class="section">
      <h3>â‘  åŸºæœ¬æƒ…å ±</h3>
      <div class="grid">
        <div class="field">
          <label>åº—èˆ—å / ä¼æ¥­å<span class="req">*</span></label>
          <input id="storeName" type="text" placeholder="ä¾‹ï¼‰ã€‡ã€‡ã‚µãƒ­ãƒ³" required>
        </div>
        <div class="field">
          <label>å¤§å…ƒã‚«ãƒ†ã‚´ãƒª<span class="req">*</span></label>
          <select id="requestType" required>
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="card">ã‚«ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</option>
            <option value="richmenu">ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆ6ãƒœã‚¿ãƒ³ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ä¿®æ­£ï¼‰</option>
            <option value="shopcard">ã‚·ãƒ§ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰</option>
            <option value="coupon">ã‚¯ãƒ¼ãƒãƒ³</option>
            <option value="other">ãã®ä»–ï¼ˆè‡ªç”±è¨˜è¿°ï¼‰</option>
          </select>
          <div class="mini">â€»é¸æŠã—ãŸã‚«ãƒ†ã‚´ãƒªã ã‘ä¸‹ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
        </div>
      </div>
    </div>

    <!-- â‘¡ ã‚«ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div id="sec-card" class="section" style="display:none">
      <h3>â‘¡ ã‚«ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰</h3>

      <!-- å…¥åŠ›ã«å¿œã˜ãŸè¦‹ãŸç›®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆè‡ªå‹•ï¼‰ -->
      <div id="cardSampleWrap" style="margin-top:20px; display:none;">
        <h4>ã‚«ãƒ¼ãƒ‰è¦‹ãŸç›®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>
        <div id="cardSampleContainer" class="sample-container"></div>
      </div>

      <div class="row" style="align-items:center; margin-bottom:10px">
        <div class="field" style="max-width:280px">
          <label>ã‚«ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ï¼ˆå…¨ã‚«ãƒ¼ãƒ‰ã®åˆæœŸå€¤ï¼‰<span class="req">*</span></label>
          <select id="cardGlobalType">
            <option value="image" selected>ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆå†™çœŸï¼‹ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ï¼‰</option>
            <option value="product">ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆï¼ˆå•†å“ï¼‰</option>
            <option value="location">ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆåº—èˆ—ãƒ»ä¼šå ´ï¼‰</option>
            <option value="person">ãƒ‘ãƒ¼ã‚½ãƒ³ï¼ˆäººç‰©ï¼‰</option>
          </select>
        </div>
      </div>

      <div class="row" style="align-items:center">
        <div class="field" style="max-width:220px">
          <label>ä½œæˆæšæ•°ï¼ˆ1ã€œ9ï¼‰<span class="req">*</span></label>
          <input id="cardCount" type="number" min="1" max="9" value="1">
          <div class="mini">å¤‰æ›´ã™ã‚‹ã¨ä¸‹ã®ã‚«ãƒ¼ãƒ‰UIã‚’å†æç”»ã—ã¾ã™</div>
        </div>
        <div class="mini">å„ã‚«ãƒ¼ãƒ‰ã¯<b>ç”»åƒ1æšå¿…é ˆ</b>ï¼ã‚¿ã‚°ï¼ˆä»»æ„ï¼‰ï¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆä»»æ„ï¼‰ã‚’è¨­å®šã§ãã¾ã™</div>
      </div>

      <div id="cardsWrap" class="row" style="margin-top:8px; gap:14px; flex-direction:column"></div>
    </div>

    <!-- â‘¢ ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <div id="sec-richmenu" class="section" style="display:none">
      <h3>â‘¢ ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
      <div class="field" style="margin-bottom:12px">
        <label>ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®é…ç½®å›³ï¼ˆã‚¿ãƒƒãƒ—/ã‚¯ãƒªãƒƒã‚¯ã§è©²å½“ãƒœã‚¿ãƒ³ã¸ã‚¸ãƒ£ãƒ³ãƒ—ï¼‰</label>
        <div class="rm-map" id="rmMapWrap">
          <img id="rmMapImg" src="https://www.dropbox.com/scl/fi/ob83wfx3fuy08m1f67vt3/1.jpg?rlkey=72kytf83rd7bhq1l09nds6gc3&st=njv25e3r&dl=1" alt="ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼é…ç½®å›³ Aã€œFï¼ˆ3x2ï¼‰">
        </div>
        <div class="legend">
          <span class="key">A â†’ ãƒœã‚¿ãƒ³1</span><span class="key">B â†’ ãƒœã‚¿ãƒ³2</span><span class="key">C â†’ ãƒœã‚¿ãƒ³3</span>
          <span class="key">D â†’ ãƒœã‚¿ãƒ³4</span><span class="key">E â†’ ãƒœã‚¿ãƒ³5</span><span class="key">F â†’ ãƒœã‚¿ãƒ³6</span>
        </div>
      </div>

      <div class="mini" style="margin:6px 0 10px">å„ãƒœã‚¿ãƒ³ã¯ã€Œãƒœã‚¿ãƒ³åã€ã¨ã€Œé·ç§»å…ˆã€ã®ä¸¡æ–¹ã‚’å…¥ã‚Œã‚‹ã¨æœ‰åŠ¹ã«ãªã‚Šã¾ã™ï¼ˆç‰‡æ–¹ã®ã¿å…¥åŠ›ã¯ã‚¨ãƒ©ãƒ¼ï¼‰ã€‚</div>

      <div id="rmButtons" class="row" style="flex-direction:column; gap:12px">
        <!-- 1ã€œ6 -->
        <div class="card" id="rmBtn1">
          <div class="mini" style="margin-bottom:6px">ãƒœã‚¿ãƒ³1</div>
          <div class="two">
            <div class="field"><label>ãƒœã‚¿ãƒ³åï¼ˆ15æ–‡å­—ï¼‰</label><input id="rmBtn1Label" maxlength="15" type="text" placeholder="ä¾‹ï¼‰äºˆç´„ã™ã‚‹"></div>
            <div class="field">
              <label>é·ç§»å…ˆã‚¿ã‚¤ãƒ—</label>
              <select id="rmBtn1Type">
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="link">URL</option>
                <option value="coupon">ã‚¯ãƒ¼ãƒãƒ³</option>
                <option value="shopcard">ã‚·ãƒ§ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰</option>
                <option value="text">ãƒ†ã‚­ã‚¹ãƒˆ</option>
              </select>
            </div>
          </div>
          <div class="field"><label>é·ç§»å…ˆå†…å®¹</label><input id="rmBtn1Value" type="text" placeholder="https:// ã¾ãŸã¯ åç§°/ãƒ†ã‚­ã‚¹ãƒˆ"></div>
        </div>

        <div class="card" id="rmBtn2">
          <div class="mini" style="margin-bottom:6px">ãƒœã‚¿ãƒ³2</div>
          <div class="two">
            <div class="field"><label>ãƒœã‚¿ãƒ³åï¼ˆ15æ–‡å­—ï¼‰</label><input id="rmBtn2Label" maxlength="15" type="text"></div>
            <div class="field">
              <label>é·ç§»å…ˆã‚¿ã‚¤ãƒ—</label>
              <select id="rmBtn2Type">
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="link">URL</option>
                <option value="coupon">ã‚¯ãƒ¼ãƒãƒ³</option>
                <option value="shopcard">ã‚·ãƒ§ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰</option>
                <option value="text">ãƒ†ã‚­ã‚¹ãƒˆ</option>
              </select>
            </div>
          </div>
          <div class="field"><label>é·ç§»å…ˆå†…å®¹</label><input id="rmBtn2Value" type="text"></div>
        </div>

        <div class="card" id="rmBtn3">
          <div class="mini" style="margin-bottom:6px">ãƒœã‚¿ãƒ³3</div>
          <div class="two">
            <div class="field"><label>ãƒœã‚¿ãƒ³åï¼ˆ15æ–‡å­—ï¼‰</label><input id="rmBtn3Label" maxlength="15" type="text"></div>
            <div class="field">
              <label>é·ç§»å…ˆã‚¿ã‚¤ãƒ—</label>
              <select id="rmBtn3Type">
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="link">URL</option>
                <option value="coupon">ã‚¯ãƒ¼ãƒãƒ³</option>
                <option value="shopcard">ã‚·ãƒ§ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰</option>
                <option value="text">ãƒ†ã‚­ã‚¹ãƒˆ</option>
              </select>
            </div>
          </div>
          <div class="field"><label>é·ç§»å…ˆå†…å®¹</label><input id="rmBtn3Value" type="text"></div>
        </div>

        <div class="card" id="rmBtn4">
          <div class="mini" style="margin-bottom:6px">ãƒœã‚¿ãƒ³4</div>
          <div class="two">
            <div class="field"><label>ãƒœã‚¿ãƒ³åï¼ˆ15æ–‡å­—ï¼‰</label><input id="rmBtn4Label" maxlength="15" type="text"></div>
            <div class="field">
              <label>é·ç§»å…ˆã‚¿ã‚¤ãƒ—</label>
              <select id="rmBtn4Type">
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="link">URL</option>
                <option value="coupon">ã‚¯ãƒ¼ãƒãƒ³</option>
                <option value="shopcard">ã‚·ãƒ§ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰</option>
                <option value="text">ãƒ†ã‚­ã‚¹ãƒˆ</option>
              </select>
            </div>
          </div>
          <div class="field"><label>é·ç§»å…ˆå†…å®¹</label><input id="rmBtn4Value" type="text"></div>
        </div>

        <div class="card" id="rmBtn5">
          <div class="mini" style="margin-bottom:6px">ãƒœã‚¿ãƒ³5</div>
          <div class="two">
            <div class="field"><label>ãƒœã‚¿ãƒ³åï¼ˆ15æ–‡å­—ï¼‰</label><input id="rmBtn5Label" maxlength="15" type="text"></div>
            <div class="field">
              <label>é·ç§»å…ˆã‚¿ã‚¤ãƒ—</label>
              <select id="rmBtn5Type">
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="link">URL</option>
                <option value="coupon">ã‚¯ãƒ¼ãƒãƒ³</option>
                <option value="shopcard">ã‚·ãƒ§ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰</option>
                <option value="text">ãƒ†ã‚­ã‚¹ãƒˆ</option>
              </select>
            </div>
          </div>
          <div class="field"><label>é·ç§»å…ˆå†…å®¹</label><input id="rmBtn5Value" type="text"></div>
        </div>

        <div class="card" id="rmBtn6">
          <div class="mini" style="margin-bottom:6px">ãƒœã‚¿ãƒ³6</div>
          <div class="two">
            <div class="field"><label>ãƒœã‚¿ãƒ³åï¼ˆ15æ–‡å­—ï¼‰</label><input id="rmBtn6Label" maxlength="15" type="text"></div>
            <div class="field">
              <label>é·ç§»å…ˆã‚¿ã‚¤ãƒ—</label>
              <select id="rmBtn6Type">
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="link">URL</option>
                <option value="coupon">ã‚¯ãƒ¼ãƒãƒ³</option>
                <option value="shopcard">ã‚·ãƒ§ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰</option>
                <option value="text">ãƒ†ã‚­ã‚¹ãƒˆ</option>
              </select>
            </div>
          </div>
          <div class="field"><label>é·ç§»å…ˆå†…å®¹</label><input id="rmBtn6Value" type="text"></div>
        </div>
      </div>
    </div>

    <!-- â‘£ ã‚·ãƒ§ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰ -->
    <div id="sec-shopcard" class="section" style="display:none">
      <h3>â‘£ ã‚·ãƒ§ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰</h3>
      <div class="grid">
        <div class="field"><label>ã‚«ãƒ¼ãƒ‰å</label><input id="scName" type="text"></div>
        <div class="field">
          <label>ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼<span class="req">*</span></label>
          <input id="scColor" type="hidden" value="#5a5aff">
          <div class="color-samples" id="colorSamples">
            <div class="color-box" data-color="#ff3b30" style="--c:#ff3b30">RED<br><span>#ff3b30</span></div>
            <div class="color-box" data-color="#ff6b00" style="--c:#ff6b00">ORANGE<br><span>#ff6b00</span></div>
            <div class="color-box" data-color="#ffa500" style="--c:#ffa500">YELLOW<br><span>#ffa500</span></div>
            <div class="color-box" data-color="#34c759" style="--c:#34c759">GREEN<br><span>#34c759</span></div>
            <div class="color-box" data-color="#5a5aff" style="--c:#5a5aff">BLUE<br><span>#5a5aff</span></div>
            <div class="color-box" data-color="#6a0dad" style="--c:#6a0dad">PURPLE<br><span>#6a0dad</span></div>
            <div class="color-box" data-color="#ff2d55" style="--c:#ff2d55">PINK<br><span>#ff2d55</span></div>
            <div class="color-box" data-color="#5c4033" style="--c:#5c4033">BROWN<br><span>#5c4033</span></div>
            <div class="color-box" data-color="#808080" style="--c:#808080">GRAY<br><span>#808080</span></div>
            <div class="color-box" data-color="#000000" style="--c:#000000">BLACK<br><span>#000000</span></div>
            <div class="color-box" data-color="#ffffff" style="--c:#ffffff;color:#000">WHITE<br><span>#ffffff</span></div>
          </div>
          <div class="mini">ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠ</div>
        </div>
        <div class="field"><label>ã‚´ãƒ¼ãƒ«ã¾ã§ã®ãƒã‚¤ãƒ³ãƒˆæ•°</label><input id="scGoalPoints" type="number" min="1" max="100" value="10"></div>
        <div class="field"><label>ã‚´ãƒ¼ãƒ«ç‰¹å…¸å</label><input id="scGoalReward" type="text"></div>
        <div class="field"><label>ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ</label><input id="scCheckpoint" type="text"></div>
        <div class="field"><label>ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆç‰¹å…¸</label><input id="scCheckpointReward" type="text"></div>
      </div>

      <div class="section" style="margin-top:18px">
        <h4>ãƒã‚¤ãƒ³ãƒˆå–å¾—åˆ¶é™</h4>
        <div class="field">
          <label><input type="radio" name="scLimit" value="sameDay" checked> åŒæ—¥ä¸­ã®é‡è¤‡ä»˜ä¸ã‚’ç¦æ­¢ï¼ˆ0:00ã«ãƒªã‚»ãƒƒãƒˆï¼‰</label><br>
          <label><input type="radio" name="scLimit" value="hours"> æŒ‡å®šæ™‚é–“å†…ã®é‡è¤‡ä»˜ä¸ã‚’ç¦æ­¢ï¼š</label>
          <select id="scLimitHours" style="margin-left:8px;">
            <option value="1">1æ™‚é–“</option><option value="3">3æ™‚é–“</option><option value="6">6æ™‚é–“</option><option value="12">12æ™‚é–“</option>
          </select><br>
          <label><input type="radio" name="scLimit" value="none"> åˆ¶é™ã—ãªã„</label>
        </div>
      </div>

      <div class="field" style="margin-top:16px;">
        <label>åˆ©ç”¨ã‚¬ã‚¤ãƒ‰</label>
        <textarea id="scGuide" placeholder="- æ¥åº—1å›ã”ã¨ã«1ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ã•ã‚Œã¾ã™ã€‚"></textarea>
      </div>

      <div class="section" style="margin-top:18px">
        <h4>ã‚«ãƒ¼ãƒ‰æœ‰åŠ¹æœŸé™</h4>
        <div class="field">
          <div class="expire-options">
            <label><input type="radio" name="scExpireType" value="lastUse" checked> æœ€çµ‚åˆ©ç”¨æ—¥ã‹ã‚‰</label>
            <input id="scExpireLastYear" type="number" min="0" value="1"> å¹´
            <input id="scExpireLastMonth" type="number" min="0" value="0"> ãƒ¶æœˆ
          </div>
          <div class="expire-options">
            <label><input type="radio" name="scExpireType" value="firstUse"> åˆå›åˆ©ç”¨æ—¥ã‹ã‚‰</label>
            <input id="scExpireFirstYear" type="number" min="0" value="1"> å¹´
            <input id="scExpireFirstMonth" type="number" min="0" value="0"> ãƒ¶æœˆ
          </div>
          <div class="expire-options">
            <label><input type="radio" name="scExpireType" value="none"> è¨­å®šã—ãªã„</label>
          </div>
        </div>

        <div class="section" style="margin-top:18px">
          <h4>æœ‰åŠ¹æœŸé™ã®é€šçŸ¥</h4>
          <div class="field">
            <label><input type="radio" name="scNotice" value="1day" checked> å‰æ—¥</label><br>
            <label><input type="radio" name="scNotice" value="3days"> 3æ—¥å‰</label><br>
            <label><input type="radio" name="scNotice" value="1week"> 1é€±é–“å‰</label><br>
            <label><input type="radio" name="scNotice" value="none"> é€šçŸ¥ã—ãªã„</label>
          </div>
        </div>

        <div class="field" style="margin-top:16px;">
          <label>ã‚«ãƒ¼ãƒ‰å–å¾—ãƒœãƒ¼ãƒŠã‚¹</label>
          <input id="scBonus" type="number" min="0" value="0"> ãƒã‚¤ãƒ³ãƒˆ
        </div>

        <div class="field" style="margin-top:16px;">
          <label>ã‚«ãƒ¼ãƒ‰ç”»åƒï¼ˆä»»æ„ï¼‰</label><input id="scImage" type="file" accept="image/*">
        </div>
      </div>
    </div>

    <!-- â‘¤ ã‚¯ãƒ¼ãƒãƒ³ -->
    <div id="sec-coupon" class="section" style="display:none">
      <h3>â‘¤ ã‚¯ãƒ¼ãƒãƒ³</h3>
      <div class="section" style="margin-top:18px">
        <h4>ã‚¯ãƒ¼ãƒãƒ³ç²å¾—æ¡ä»¶</h4>
        <div class="coupon-card-container">
          <div class="coupon-card active" data-type="none"><h5>ğŸ æ¡ä»¶ãªã—</h5><p>ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç²å¾—å¯èƒ½</p></div>
          <div class="coupon-card" data-type="lottery"><h5>ğŸ¯ æŠ½é¸</h5><p>å½“é¸è€…ã®ã¿ç²å¾—å¯èƒ½</p></div>
          <div class="coupon-card" data-type="referral"><h5>ğŸ¤ å‹ã ã¡ç´¹ä»‹</h5><p>ç´¹ä»‹ã—ãŸäººãƒ»ã•ã‚ŒãŸäººãŒå¯¾è±¡</p></div>
        </div>

        <input type="hidden" id="cpAcquireType" value="none">

        <!-- æ¡ä»¶ãªã— -->
        <div id="cp-none-settings" class="coupon-settings" style="display:block;">
          <div class="grid">
            <div class="field"><label>ã‚¯ãƒ¼ãƒãƒ³åï¼ˆ60æ–‡å­—ï¼‰</label><input id="cpNoneName" maxlength="60" type="text"></div>
            <div class="field"><label>ã‚¯ãƒ¼ãƒãƒ³å†…å®¹</label><input id="cpNoneContent" type="text" placeholder="ä¾‹ï¼š500å††å¼•ãï¼â—‹â—‹ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆãªã©"></div>
            <div class="field"><label>æœ‰åŠ¹æœŸé–“</label><input id="cpNoneStart" type="datetime-local"> ï½ <input id="cpNoneEnd" type="datetime-local"></div>
            <div class="field">
              <label>åˆ©ç”¨ã‚¬ã‚¤ãƒ‰</label>
              <textarea id="cpNoneGuide">- ã‚¯ãƒ¼ãƒãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ã“ã®ç”»é¢ã‚’ã‚¹ã‚¿ãƒƒãƒ•ã«æç¤ºã—ã¦ãã ã•ã„ã€‚</textarea>
            </div>
            <div class="field"><label>ä½¿ç”¨ç”¨é€”</label><input id="cpNoneUse" type="text"></div>
            <div class="field">
              <label>ä½¿ç”¨å¯èƒ½å›æ•°</label>
              <select id="cpNoneLimit">
                <option value="once">1å›ã®ã¿</option>
                <option value="unlimited">ä¸Šé™ãªã—</option>
              </select>
            </div>
            <div class="field"><label>ï¼ˆä»»æ„ï¼‰åˆ©ç”¨æ¡ä»¶</label><input id="cpNoneCondition" type="text"></div>
          </div>
        </div>

        <!-- æŠ½é¸ -->
        <div id="cp-lottery-settings" class="coupon-settings" style="display:none;">
          <div class="grid">
            <div class="field"><label>ã‚¯ãƒ¼ãƒãƒ³åï¼ˆ60æ–‡å­—ï¼‰</label><input id="cpLotteryName" maxlength="60" type="text"></div>
            <div class="field"><label>ã‚¯ãƒ¼ãƒãƒ³å†…å®¹</label><input id="cpLotteryContent" type="text"></div>
            <div class="field"><label>æœ‰åŠ¹æœŸé–“</label><input id="cpLotteryStart" type="datetime-local"> ï½ <input id="cpLotteryEnd" type="datetime-local"></div>
            <div class="field"><label>åˆ©ç”¨ã‚¬ã‚¤ãƒ‰</label><textarea id="cpLotteryGuide">- ã‚¯ãƒ¼ãƒãƒ³æç¤ºã§ã”åˆ©ç”¨ãã ã•ã„ã€‚</textarea></div>
            <div class="field"><label>å½“é¸ç¢ºç‡ï¼ˆ1ï½99%ï¼‰</label><input id="cpLotteryRate" type="number" min="1" max="99" value="50"></div>
            <div class="field"><label>å½“é¸è€…æ•°ã®ä¸Šé™</label><input id="cpLotteryMax" type="number" min="1" placeholder="ä¾‹ï¼š100"></div>
            <div class="field"><label>ä½¿ç”¨ç”¨é€”</label><input id="cpLotteryUse" type="text"></div>
            <div class="field"><label>ä½¿ç”¨å¯èƒ½å›æ•°</label>
              <select id="cpLotteryLimit"><option value="once">1å›ã®ã¿</option><option value="unlimited">ä¸Šé™ãªã—</option></select>
            </div>
            <div class="field"><label>ï¼ˆä»»æ„ï¼‰åˆ©ç”¨æ¡ä»¶</label><input id="cpLotteryCondition" type="text"></div>
          </div>
        </div>

        <!-- å‹ã ã¡ç´¹ä»‹ -->
        <div id="cp-referral-settings" class="coupon-settings" style="display:none;">
          <div class="grid">
            <div class="field"><label>ã‚¯ãƒ¼ãƒãƒ³åï¼ˆ60æ–‡å­—ï¼‰</label><input id="cpReferralName" maxlength="60" type="text"></div>
            <div class="field"><label>ç´¹ä»‹æœŸé–“</label><input id="cpReferralStart" type="datetime-local"> ï½ <input id="cpReferralEnd" type="datetime-local"></div>
            <div class="field"><label>æ³¨æ„äº‹é …</label><textarea id="cpReferralNote">- äºˆå‘Šãªãå¤‰æ›´ã¾ãŸã¯çµ‚äº†ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</textarea></div>
            <div class="field">
              <label>ã‚¯ãƒ¼ãƒãƒ³ç²å¾—æ—¥ã‹ã‚‰ã®æœ‰åŠ¹æœŸé–“</label>
              <select id="cpReferralValidType"><option value="7">7æ—¥é–“</option><option value="30">30æ—¥é–“</option><option value="custom">ã‚«ã‚¹ã‚¿ãƒ è¨­å®š</option></select>
              <input id="cpReferralCustomDays" type="number" min="1" max="180" placeholder="1ï½180æ—¥é–“" style="display:none;margin-top:6px;">
            </div>
            <div class="field"><label>ã‚¯ãƒ¼ãƒãƒ³å†…å®¹</label><input id="cpReferralContent" type="text"></div>
            <div class="field"><label>åˆ©ç”¨ã‚¬ã‚¤ãƒ‰</label><textarea id="cpReferralGuide">- ã‚¯ãƒ¼ãƒãƒ³æç¤ºã§ã”åˆ©ç”¨ãã ã•ã„ã€‚</textarea></div>
            <div class="field"><label>ä½¿ç”¨ç”¨é€”</label><input id="cpReferralUse" type="text"></div>
            <div class="field">
              <label>ç²å¾—å¯èƒ½å›æ•°</label>
              <select id="cpReferralCountType"><option value="unlimited">ä¸Šé™ãªã—</option><option value="custom">ã‚«ã‚¹ã‚¿ãƒ è¨­å®š</option></select>
              <input id="cpReferralCountCustom" type="number" min="1" max="30" placeholder="1ï½30å›" style="display:none;margin-top:6px;">
            </div>
            <div class="field"><label>ï¼ˆä»»æ„ï¼‰åˆ©ç”¨æ¡ä»¶</label><input id="cpReferralCondition" type="text"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- â‘¥ ãã®ä»–ï¼ˆè‡ªç”±è¨˜è¿°ï¼‰ -->
    <div id="sec-other" class="section" style="display:none">
      <h3>â‘¥ ãã®ä»–</h3>
      <div class="field">
        <label>è‡ªç”±è¨˜è¿°</label>
        <textarea id="otherText" placeholder="ã”å¸Œæœ›ã‚„è£œè¶³äº‹é …ã‚’è‡ªç”±ã«ãŠæ›¸ããã ã•ã„"></textarea>
      </div>
      <div class="field">
        <label>ç”»åƒï¼ˆä»»æ„ãƒ»è¤‡æ•°å¯ï¼‰</label>
        <input id="otherImages" type="file" multiple accept="image/*">
      </div>
      <div class="buttons">
        <button class="primary" type="button" id="btnSubmitOther">ã“ã®è‡ªç”±è¨˜è¿°ã‚’é€ä¿¡</button>
        <span class="mini">â€»ä¸Šã®ã‚«ãƒ†ã‚´ãƒªé¸æŠã§ã€Œãã®ä»–ï¼ˆè‡ªç”±è¨˜è¿°ï¼‰ã€ã‚’é¸ã‚“ã çŠ¶æ…‹ã§é€ä¿¡ã—ã¾ã™ã€‚</span>
      </div>
    </div>
  </div>

  <script>
    const GAS_URL = "https://super-term-2b6b.y-kimura11223.workers.dev/";
    const $ = s => document.querySelector(s);
    const on = (el, evt, fn) => el && el.addEventListener(evt, fn);
    const show = (el, v = true) => el.style.display = v ? '' : 'none';

    // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†
    const sections = {
      card: $('#sec-card'),
      richmenu: $('#sec-richmenu'),
      shopcard: $('#sec-shopcard'),
      coupon: $('#sec-coupon'),
      other: $('#sec-other')
    };

    on($('#requestType'), 'change', () => {
      Object.values(sections).forEach(s => show(s, false));
      const v = $('#requestType').value;
      if (!v) return;
      show(sections[v], true);

      // è¡¨ç¤ºç›´å¾Œã®åˆæœŸåŒ–ï¼ˆå¹…0å¯¾ç­–ï¼‰
      if (v === 'richmenu') {
        initRichmenuHotspots();
        wireInputFocusToHighlight();
      }
      if (v === 'card') renderCards();

      ensureLocalActions(sections[v]);
    });

    // ---- ã‚«ãƒ¼ãƒ‰UIç”Ÿæˆ ----
    function renderCards() {
      const wrap = $('#cardsWrap');
      const cntEl = $('#cardCount');
      const n = Math.max(1, Math.min(9, parseInt(cntEl?.value || '1')));
      if (cntEl) cntEl.value = String(n);
      wrap.innerHTML = '';
      const globalType = ($('#cardGlobalType')?.value || 'image');

      const buildSubfields = (t) => {
        if (t === 'product') {
          return `
            <div class="row" style="gap:12px; align-items:flex-end; flex-wrap:wrap">
              <div class="field" style="min-width:240px;">
                <label>ç”»åƒï¼ˆå¿…é ˆãƒ»1æšã¾ã§ï¼‰<span class="req">*</span></label>
                <input type="file" class="cd-image" accept="image/*" required>
              </div>
              <div class="field" style="min-width:200px; flex:1">
                <label>ã‚¿ã‚°ï¼ˆä»»æ„ãƒ»æœ€å¤§12æ–‡å­—ï¼‰</label>
                <input type="text" class="pd-tag" maxlength="12" placeholder="ä¾‹ï¼‰æ–°ç€ / äººæ°—">
              </div>
            </div>

            <div class="subfields active">
              <div class="grid">
                <div class="field">
                  <label>ã‚«ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ20æ–‡å­—å¿…é ˆï¼‰<span class="req">*</span></label>
                  <input type="text" class="pd-title" maxlength="20" placeholder="ä¾‹ï¼‰ãŠã¾ã‹ã›ã‚³ãƒ¼ã‚¹60åˆ†" required>
                </div>
                <div class="field">
                  <label>ä¾¡æ ¼ï¼ˆ15æ–‡å­—ãƒ»å††/\\ å¯ï¼‰</label>
                  <input type="text" class="pd-priceText" maxlength="15" placeholder="ä¾‹ï¼‰5,980å†† / \\5980">
                </div>
                <div class="field" style="grid-column:1/-1">
                  <label>èª¬æ˜æ–‡ï¼ˆ60æ–‡å­—ä»»æ„ï¼‰</label>
                  <textarea class="pd-desc" maxlength="60" placeholder="ä¾‹ï¼‰çŠ¶æ…‹ã«åˆã‚ã›ã¦æœ€é©ã«æ–½è¡“ã—ã¾ã™ã€‚"></textarea>
                </div>
              </div>
            </div>
          `;
        }
        if (t === 'location') {
          return `
            <div class="row" style="gap:12px; align-items:flex-end; flex-wrap:wrap">
              <div class="field" style="min-width:240px;">
                <label>ç”»åƒï¼ˆå¿…é ˆãƒ»1æšã¾ã§ï¼‰<span class="req">*</span></label>
                <input type="file" class="cd-image" accept="image/*" required>
              </div>
              <div class="field" style="min-width:200px; flex:1">
                <label>ã‚¿ã‚°ï¼ˆä»»æ„ãƒ»æœ€å¤§12æ–‡å­—ï¼‰</label>
                <input type="text" class="lc-tag" maxlength="12" placeholder="ä¾‹ï¼‰æœ¬åº— / æ–°è£…é–‹åº—">
              </div>
            </div>

            <div class="subfields active">
              <div class="grid">
                <div class="field">
                  <label>ã‚«ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ20æ–‡å­—å¿…é ˆï¼‰<span class="req">*</span></label>
                  <input type="text" class="lc-title" maxlength="20" placeholder="ä¾‹ï¼‰åº—èˆ—åãªã©" required>
                </div>
                <div class="field" style="grid-column:1/-1">
                  <label>ä½æ‰€ï¼ˆ60æ–‡å­—ä»»æ„ï¼‰</label>
                  <input type="text" class="lc-address" maxlength="60">
                </div>
                <div class="field">
                  <label>æ™‚é–“ï¼ˆ30æ–‡å­— ä»»æ„ï¼‰</label>
                  <input type="text" class="lc-hours" maxlength="30">
                </div>
                <div class="field">
                  <label>ä¾¡æ ¼ï¼ˆ15æ–‡å­— ä»»æ„ãƒ»å††/\\ å¯ï¼‰</label>
                  <input type="text" class="lc-priceText" maxlength="15">
                </div>
              </div>
              <div class="mini">â€»ã€Œæ™‚é–“ã€ã¾ãŸã¯ã€Œä¾¡æ ¼ã€ã®ã©ã¡ã‚‰ã‹ä¸€æ–¹ã§ã‚‚OK</div>
            </div>
          `;
        }
        if (t === 'person') {
          return `
            <div class="row" style="gap:12px; align-items:flex-end; flex-wrap:wrap">
              <div class="field" style="min-width:240px;">
                <label>ç”»åƒï¼ˆå¿…é ˆãƒ»1æšã¾ã§ï¼‰<span class="req">*</span></label>
                <input type="file" class="cd-image" accept="image/*" required>
              </div>
            </div>

            <div class="subfields active">
              <div class="grid">
                <div class="field">
                  <label>åå‰ï¼ˆ20æ–‡å­—å¿…é ˆï¼‰<span class="req">*</span></label>
                  <input type="text" class="ps-name" maxlength="20" required>
                </div>
                <div class="field"><label>ã‚¿ã‚°1ï¼ˆä»»æ„ï¼‰</label><input type="text" class="ps-tag1" maxlength="12"></div>
                <div class="field"><label>ã‚¿ã‚°2ï¼ˆä»»æ„ï¼‰</label><input type="text" class="ps-tag2" maxlength="12"></div>
                <div class="field"><label>ã‚¿ã‚°3ï¼ˆä»»æ„ï¼‰</label><input type="text" class="ps-tag3" maxlength="12"></div>
                <div class="field" style="grid-column:1/-1">
                  <label>èª¬æ˜æ–‡ï¼ˆ60æ–‡å­—ä»»æ„ï¼‰</label>
                  <textarea class="ps-desc" maxlength="60"></textarea>
                </div>
              </div>
            </div>
          `;
        }
        return `
          <div class="row" style="gap:12px; align-items:flex-end; flex-wrap:wrap">
            <div class="field" style="min-width:240px;">
              <label>ç”»åƒï¼ˆå¿…é ˆãƒ»1æšã¾ã§ï¼‰<span class="req">*</span></label>
              <input type="file" class="cd-image" accept="image/*" required>
            </div>
            <div class="field" style="min-width:200px; flex:1">
              <label>ã‚¿ã‚°ï¼ˆä»»æ„ãƒ»æœ€å¤§12æ–‡å­—ï¼‰</label>
              <input type="text" class="img-tag" maxlength="12" placeholder="ä¾‹ï¼‰æœŸé–“é™å®š">
            </div>
          </div>
        `;
      };

      const buildActions = (t) => {
        if (t === 'image') {
          return `
            <div class="two" style="margin-top:10px">
              <div class="field">
                <label>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³1ï¼ˆä»»æ„ãƒ»ãƒœã‚¿ãƒ³å15æ–‡å­—ï¼‰</label>
                <input type="text" class="btn1-label" maxlength="15" placeholder="ä¾‹ï¼‰äºˆç´„ã™ã‚‹ / è©³ç´°ã‚’è¦‹ã‚‹">
              </div>
              <div class="field">
                <label>é·ç§»å…ˆ1ï¼ˆURL / ã‚¯ãƒ¼ãƒãƒ³ / ã‚·ãƒ§ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰ / ãƒ†ã‚­ã‚¹ãƒˆï¼‰</label>
                <input type="text" class="btn1-dest" placeholder="https:// ã¾ãŸã¯ åç§°/ãƒ†ã‚­ã‚¹ãƒˆ">
              </div>
            </div>
          `;
        }
        return `
          <div class="two" style="margin-top:10px">
            <div class="field">
              <label>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³1ï¼ˆä»»æ„ãƒ»ãƒœã‚¿ãƒ³å15æ–‡å­—ï¼‰</label>
              <input type="text" class="btn1-label" maxlength="15" placeholder="ä¾‹ï¼‰äºˆç´„ã™ã‚‹ / è©³ç´°ã‚’è¦‹ã‚‹">
            </div>
            <div class="field">
              <label>é·ç§»å…ˆ1ï¼ˆURL / ã‚¯ãƒ¼ãƒãƒ³ / ã‚·ãƒ§ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰ / ãƒ†ã‚­ã‚¹ãƒˆï¼‰</label>
              <input type="text" class="btn1-dest" placeholder="https:// ã¾ãŸã¯ åç§°/ãƒ†ã‚­ã‚¹ãƒˆ">
            </div>
          </div>
          <div class="two" style="margin-top:10px">
            <div class="field">
              <label>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³2ï¼ˆä»»æ„ãƒ»ãƒœã‚¿ãƒ³å15æ–‡å­—ï¼‰</label>
              <input type="text" class="btn2-label" maxlength="15" placeholder="ä¾‹ï¼‰ç©ºå¸­ç¢ºèª / é›»è©±ã™ã‚‹">
            </div>
            <div class="field">
              <label>é·ç§»å…ˆ2ï¼ˆURL / ã‚¯ãƒ¼ãƒãƒ³ / ã‚·ãƒ§ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰ / ãƒ†ã‚­ã‚¹ãƒˆï¼‰</label>
              <input type="text" class="btn2-dest" placeholder="https:// ã¾ãŸã¯ åç§°/ãƒ†ã‚­ã‚¹ãƒˆ">
            </div>
          </div>
        `;
      };

      for (let i = 0; i < n; i++) {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.index = String(i);
        card.dataset.type = globalType;
        card.innerHTML = `${buildSubfields(globalType)}${buildActions(globalType)}`;
        wrap.appendChild(card);
      }

      // è»½ã„ãƒ‡ã‚£ãƒ¬ã‚¤ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼åæ˜ 
      setTimeout(updateCardPreview, 200);
    }

    on($('#cardCount'), 'change', renderCards);
    on($('#cardGlobalType'), 'change', renderCards);

    // Base64 æ·»ä»˜
    async function appendFilesBase64(fd, selector, namePrefix) {
      const inputs = Array.from(document.querySelectorAll(`${selector} input[type="file"]`));
      let idx = 0;
      for (const input of inputs) {
        const files = Array.from(input.files || []);
        for (const file of files) {
          await new Promise((resolve, reject) => {
            const fr = new FileReader();
            fr.onload = () => {
              fd.append('b64_' + namePrefix + '_' + (idx++), String(fr.result));
              resolve();
            };
            fr.onerror = reject;
            fr.readAsDataURL(file);
          });
        }
      }
    }

    function collectData() {
      const base = {
        storeName: $('#storeName').value.trim(),
        requestType: $('#requestType').value,
        createdAt: new Date().toISOString(),
      };

      const detail = {};

      if (base.requestType === 'card') {
        const cardType = ($('#cardGlobalType')?.value || 'image');
        const cards = [];
        const nodes = document.querySelectorAll('#cardsWrap .card');

        nodes.forEach((c, idx) => {
          let meta = {};
          let tag = '';

          if (cardType === 'product') {
            tag = (c.querySelector('.pd-tag')?.value || '').trim();
            meta = {
              title: (c.querySelector('.pd-title')?.value || '').trim(),
              desc: (c.querySelector('.pd-desc')?.value || '').trim(),
              priceText: (c.querySelector('.pd-priceText')?.value || '').trim()
            };
          } else if (cardType === 'location') {
            tag = (c.querySelector('.lc-tag')?.value || '').trim();
            meta = {
              title: (c.querySelector('.lc-title')?.value || '').trim(),
              address: (c.querySelector('.lc-address')?.value || '').trim(),
              hours: (c.querySelector('.lc-hours')?.value || '').trim(),
              priceText: (c.querySelector('.lc-priceText')?.value || '').trim()
            };
          } else if (cardType === 'person') {
            meta = {
              name: (c.querySelector('.ps-name')?.value || '').trim(),
              tags: [
                (c.querySelector('.ps-tag1')?.value || '').trim(),
                (c.querySelector('.ps-tag2')?.value || '').trim(),
                (c.querySelector('.ps-tag3')?.value || '').trim()
              ].filter(Boolean),
              desc: (c.querySelector('.ps-desc')?.value || '').trim()
            };
          } else {
            tag = (c.querySelector('.img-tag')?.value || '').trim();
            meta = {};
          }

          const actions = [];
          const b1 = { label: (c.querySelector('.btn1-label')?.value || '').trim(), dest: (c.querySelector('.btn1-dest')?.value || '').trim() };
          if (cardType === 'image') {
            if (b1.label && b1.dest) actions.push({ label: b1.label, destination: b1.dest });
          } else {
            const b2 = { label: (c.querySelector('.btn2-label')?.value || '').trim(), dest: (c.querySelector('.btn2-dest')?.value || '').trim() };
            if (b1.label && b1.dest) actions.push({ label: b1.label, destination: b1.dest });
            if (b2.label && b2.dest) actions.push({ label: b2.label, destination: b2.dest });
          }

          cards.push({ index: idx + 1, type: cardType, image: 'attached_as_b64_cardImage_' + idx, tag, meta, actions });
        });

        detail.cards = cards;
      }

      if (base.requestType === 'other') {
        const files = Array.from($('#otherImages')?.files || []);
        detail.other = {
          text: ($('#otherText')?.value || '').trim(),
          imagesMeta: files.map(f => ({ name: f.name, size: f.size, type: f.type }))
        };
      }

      return { base, detail };
    }

    // é€ä¿¡ã®ã¿
    async function submitForm() {
      const { base, detail } = collectData();

      // å¿…é ˆ
      if (!base.storeName || !base.requestType) {
        alert('åº—èˆ—å ã¨ å¤§å…ƒã‚«ãƒ†ã‚´ãƒª ã¯å¿…é ˆã§ã™');
        return;
      }

      // ã‚«ãƒ¼ãƒ‰æ™‚ã®ãƒã‚§ãƒƒã‚¯
      if (base.requestType === 'card') {
        const cards = document.querySelectorAll('#cardsWrap .card');
        if (cards.length === 0) { alert('ã‚«ãƒ¼ãƒ‰æšæ•°ã‚’1ã€œ9ã§æŒ‡å®šã—ã¦ãã ã•ã„'); return; }
        if (cards.length > 9) { alert('ã‚«ãƒ¼ãƒ‰ã¯æœ€å¤§9æšã¾ã§ã§ã™'); return; }

        const cardType = ($('#cardGlobalType')?.value || 'image');

        for (let i = 0; i < cards.length; i++) {
          const card = cards[i];

          const img = card.querySelector('.cd-image');
          const files = img?.files || [];
          if (!files.length) { alert(`ã‚«ãƒ¼ãƒ‰${i + 1}: ç”»åƒã‚’1æšé¸æŠã—ã¦ãã ã•ã„`); return; }
          if (files.length > 1) { alert(`ã‚«ãƒ¼ãƒ‰${i + 1}: ç”»åƒã¯1æšã®ã¿é¸æŠã—ã¦ãã ã•ã„`); return; }

          if (cardType === 'product') {
            const title = card.querySelector('.pd-title')?.value.trim();
            if (!title) { alert(`ã‚«ãƒ¼ãƒ‰${i + 1}: ã‚«ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆå•†å“ï¼‰ã¯å¿…é ˆã§ã™`); return; }
          } else if (cardType === 'location') {
            const title = card.querySelector('.lc-title')?.value.trim();
            const hours = card.querySelector('.lc-hours')?.value.trim();
            const priceText = card.querySelector('.lc-priceText')?.value.trim();
            if (!title) { alert(`ã‚«ãƒ¼ãƒ‰${i + 1}: ã‚«ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã¯å¿…é ˆã§ã™`); return; }
            if (hours && priceText) { alert(`ã‚«ãƒ¼ãƒ‰${i + 1}: ã€Œæ™‚é–“ã€ã¨ã€Œä¾¡æ ¼ã€ã¯ã©ã¡ã‚‰ã‹ä¸€æ–¹ã®ã¿å…¥åŠ›ã—ã¦ãã ã•ã„`); return; }
          } else if (cardType === 'person') {
            const name = card.querySelector('.ps-name')?.value.trim();
            if (!name) { alert(`ã‚«ãƒ¼ãƒ‰${i + 1}: åå‰ï¼ˆäººç‰©ï¼‰ã¯å¿…é ˆã§ã™`); return; }
          }

          const btn1 = { label: (card.querySelector('.btn1-label')?.value || '').trim(), dest: (card.querySelector('.btn1-dest')?.value || '').trim() };
          const btns = (cardType === 'image')
            ? [btn1]
            : [ btn1, { label: (card.querySelector('.btn2-label')?.value || '').trim(), dest: (card.querySelector('.btn2-dest')?.value || '').trim() } ];

          for (let j = 0; j < btns.length; j++) {
            const b = btns[j];
            const any = !!(b.label || b.dest);
            if (any && (!b.label || !b.dest)) { alert(`ã‚«ãƒ¼ãƒ‰${i + 1}: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³${j + 1}ã¯ã€Œãƒœã‚¿ãƒ³åã€ã¨ã€Œé·ç§»å…ˆã€ã‚’ä¸¡æ–¹å…¥åŠ›ã—ã¦ãã ã•ã„`); return; }
            if (b.dest && /^https?:\/\//i.test(b.dest) === false && b.dest.includes('http')) {
              alert(`ã‚«ãƒ¼ãƒ‰${i + 1}: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³${j + 1}ã®é·ç§»å…ˆãŒURLã‚‰ã—ã„ã§ã™ãŒ http(s):// ã‹ã‚‰å§‹ã‚ã¦ãã ã•ã„`);
              return;
            }
          }
        }
      }

      // ãã®ä»–
      if (base.requestType === 'other') {
        if (!detail.other?.text && (!$('#otherImages') || !$('#otherImages').files.length)) {
          alert('è‡ªç”±è¨˜è¿°ã¾ãŸã¯ç”»åƒã®ã©ã¡ã‚‰ã‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          return;
        }
      }

      // é€ä¿¡
      const fd = new FormData();
      fd.append('payload', JSON.stringify({ base, detail }));

      await appendFilesBase64(fd, '#cardsWrap', 'cardImage');
      await appendFilesBase64(fd, '#scImage', 'scImage');
      await appendFilesBase64(fd, '#otherImages', 'othImage');

      try {
        const res = await fetch(GAS_URL, { method: 'POST', body: fd });
        const txt = await res.text();
        let data; try { data = JSON.parse(txt); } catch { data = { raw: txt }; }
        console.log('é€ä¿¡çµæœ:', data);
        alert('é€ä¿¡ã—ã¾ã—ãŸã€‚å•é¡Œãªã‘ã‚Œã°ã“ã®ã¾ã¾ç”»é¢ã‚’é–‰ã˜ã¦OKã§ã™ã€‚');
      } catch (err) {
        alert('é€ä¿¡ã‚¨ãƒ©ãƒ¼: ' + err.message);
      }
    }

    // ã€Œãã®ä»–ã€å°‚ç”¨é€ä¿¡
    on($('#btnSubmitOther'), 'click', () => {
      const sel = $('#requestType');
      if (sel && sel.value !== 'other') sel.value = 'other';
      Object.values(sections).forEach(s => show(s, false));
      show(sections.other, true);
      submitForm();
    });

    // ã‚«ãƒ©ãƒ¼é¸æŠï¼ˆ12è‰²ãƒ»åˆæœŸé¸æŠå¾©å…ƒï¼‰
    document.addEventListener('DOMContentLoaded', () => {
      const boxes = document.querySelectorAll('#colorSamples .color-box');
      const hidden = document.getElementById('scColor');
      if (!boxes.length || !hidden) return;

      const init = (hidden.value || '').toLowerCase();
      let hit = false;
      boxes.forEach(box => {
        if (box.dataset.color && box.dataset.color.toLowerCase() === init) {
          box.classList.add('selected'); hit = true;
        }
      });
      if (!hit) { boxes[0].classList.add('selected'); hidden.value = boxes[0].dataset.color; }

      boxes.forEach(box => {
        box.addEventListener('click', () => {
          boxes.forEach(b => b.classList.remove('selected'));
          box.classList.add('selected');
          hidden.value = box.dataset.color;
        });
      });
    });

    // ã‚¯ãƒ¼ãƒãƒ³ã‚«ãƒ¼ãƒ‰åˆ‡æ›¿
    document.querySelectorAll('.coupon-card').forEach(card => {
      card.addEventListener('click', () => {
        document.querySelectorAll('.coupon-card').forEach(c => c.classList.remove('active'));
        card.classList.add('active');
        const type = card.dataset.type;
        document.getElementById('cpAcquireType').value = type;
        document.querySelectorAll('.coupon-settings').forEach(s => s.style.display = 'none');
        document.getElementById(`cp-${type}-settings`).style.display = 'block';
      });
    });

    // å‹ã ã¡ç´¹ä»‹ã‚«ã‚¹ã‚¿ãƒ 
    const referralValidSelect = document.getElementById('cpReferralValidType');
    const referralCustomDays = document.getElementById('cpReferralCustomDays');
    if (referralValidSelect) referralValidSelect.addEventListener('change', () => {
      referralCustomDays.style.display = referralValidSelect.value === 'custom' ? 'block' : 'none';
    });
    const referralCountType = document.getElementById('cpReferralCountType');
    const referralCountCustom = document.getElementById('cpReferralCountCustom');
    if (referralCountType) referralCountType.addEventListener('change', () => {
      referralCountCustom.style.display = referralCountType.value === 'custom' ? 'block' : 'none';
    });

    // ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼šãƒ›ãƒƒãƒˆã‚¹ãƒãƒƒãƒˆ
    function initRichmenuHotspots() {
      const wrap = document.getElementById('rmMapWrap');
      const img = document.getElementById('rmMapImg');
      if (!wrap || !img) return;

      const grid = [
        { area: 'A', btn: 1, col: 0, row: 0 },
        { area: 'B', btn: 2, col: 1, row: 0 },
        { area: 'C', btn: 3, col: 2, row: 0 },
        { area: 'D', btn: 4, col: 0, row: 1 },
        { area: 'E', btn: 5, col: 1, row: 1 },
        { area: 'F', btn: 6, col: 2, row: 1 },
      ];

      const renderHotspots = () => {
        const imgW = img.offsetWidth;
        const imgH = img.offsetHeight;
        if (!imgW || !imgH) return;

        const cellW = imgW / 3;
        const cellH = imgH / 2;

        wrap.querySelectorAll('.rm-hot').forEach(el => el.remove());

        grid.forEach(g => {
          const d = document.createElement('div');
          d.className = 'rm-hot';
          d.dataset.btn = g.btn;
          Object.assign(d.style, {
            left: `${g.col * cellW}px`,
            top: `${g.row * cellH}px`,
            width: `${cellW}px`,
            height: `${cellH}px`,
            position: "absolute",
            zIndex: 20
          });
          d.addEventListener('click', () => highlightAndScroll(g.btn));
          wrap.appendChild(d);
        });
      };

      if (img.complete && img.naturalWidth > 0) renderHotspots();
      else img.addEventListener('load', renderHotspots);
      window.addEventListener('resize', renderHotspots);
      window.addEventListener('scroll', renderHotspots);

      // è¡¨ç¤ºåˆ‡æ›¿ç›´å¾Œã§ã‚‚ç¢ºå®Ÿã«æç”»
      requestAnimationFrame(renderHotspots);
    }

    function toggleHighlight(btnIndex, on) {
      const card = document.getElementById('rmBtn' + btnIndex);
      const hotspot = document.querySelector(`.rm-hot[data-btn="${btnIndex}"]`);
      if (card) card.classList.toggle('highlight', !!on);
      if (hotspot) hotspot.classList.toggle('active', !!on);
    }

    function highlightAndScroll(btnIndex) {
      for (let i = 1; i <= 6; i++) {
        const c = document.getElementById('rmBtn' + i);
        const h = document.querySelector(`.rm-hot[data-btn="${i}"]`);
        if (c) c.classList.remove('highlight');
        if (h) h.classList.remove('active');
      }

      const card = document.getElementById('rmBtn' + btnIndex);
      const hotspot = document.querySelector(`.rm-hot[data-btn="${btnIndex}"]`);
      if (!card || !hotspot) return;

      card.scrollIntoView({ behavior: 'smooth', block: 'center' });

      setTimeout(() => {
        card.classList.add('highlight');
        hotspot.classList.add('active');
        setTimeout(() => {
          card.classList.remove('highlight');
          hotspot.classList.remove('active');
        }, 1500);
      }, 350);
    }

    function wireInputFocusToHighlight() {
      for (let i = 1; i <= 6; i++) {
        const card = document.getElementById('rmBtn' + i);
        if (!card) continue;
        card.querySelectorAll('input,select,textarea').forEach(el => {
          el.addEventListener('focus', () => toggleHighlight(i, true));
          el.addEventListener('blur',  () => toggleHighlight(i, false));
        });
      }
    }

    // å„ã‚«ãƒ†ã‚´ãƒªã®ãƒ­ãƒ¼ã‚«ãƒ«æ“ä½œï¼ˆé€ä¿¡ã®ã¿ï¼‰â€»ã€Œãã®ä»–ã€ã¯å°‚ç”¨ãƒœã‚¿ãƒ³ã‚ã‚Š
    function ensureLocalActions(sectionEl) {
      if (!sectionEl || sectionEl.querySelector('.local-actions')) return;
      if (sectionEl.id === 'sec-other') return;
      const actions = document.createElement('div');
      actions.className = 'local-actions';
      actions.innerHTML = `
        <button type="button" class="primary btnSubmitLocal">ã“ã®å†…å®¹ã§é€ä¿¡</button>
        <span class="tip">â€»ä¸Šéƒ¨ã®å¿…é ˆé …ç›®ã‚‚ã”ç¢ºèªãã ã•ã„</span>
      `;
      sectionEl.appendChild(actions);
      actions.querySelector('.btnSubmitLocal').addEventListener('click', submitForm);
    }
    function mountLocalActionsToAll() {
      Object.values(sections).forEach(sec => ensureLocalActions(sec));
    }

    // ã‚«ãƒ¼ãƒ‰è¦‹ãŸç›®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆè‡ªå‹•åæ˜ ï¼‰
    function updateCardPreview() {
      const wrap = document.querySelector("#cardSampleContainer");
      const cards = document.querySelectorAll("#cardsWrap .card");
      wrap.innerHTML = "";
      if (!cards.length) {
        document.querySelector("#cardSampleWrap").style.display = "none";
        return;
      }
      document.querySelector("#cardSampleWrap").style.display = "";

      cards.forEach((card, idx) => {
        const type  = card.dataset.type || "product";
        const tag   = card.querySelector(".img-tag, .pd-tag, .lc-tag")?.value?.trim() || "";
        const title = card.querySelector(".pd-title, .lc-title, .ps-name")?.value?.trim() || "";
        const desc  = card.querySelector(".pd-desc, .lc-address, .ps-desc")?.value?.trim() || "";
        const price = card.querySelector(".pd-priceText, .lc-priceText")?.value?.trim() || "";
        const b1    = card.querySelector(".btn1-label")?.value?.trim() || "";

        let imgSrc = "data:image/svg+xml;base64," + btoa('<svg xmlns="http://www.w3.org/2000/svg" width="400" height="240"><rect width="400" height="240" fill="#eaeaea"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="20" fill="#999">No Image</text></svg>');

        const cardEl = document.createElement("div");
        cardEl.className = "sample-card";
        cardEl.id = `sampleCard${idx}`;

        let innerHTML = "";
        if (type === "location") {
          const hours = card.querySelector(".lc-hours")?.value?.trim() || "";
          const line2 = hours ? `ğŸ•’ ${hours}` : (price ? `ğŸ’´ ${price}` : "");
          innerHTML = `
            <img src="${imgSrc}" alt="">
            <div class="sample-body">
              ${tag ? `<div class="tag">${tag}</div>` : ""}
              <div class="title">${title || "ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›"}</div>
              <div class="desc">
                <div>ğŸ“ ${desc || ""}</div>
                ${line2 ? `<div>${line2}</div>` : ""}
              </div>
            </div>
            ${b1 ? `<div class="buttons"><div class="btn">${b1}</div></div>` : ""}
          `;
        } else if (type === "person") {
          innerHTML = `
            <div class="person-card">
              <div class="person-img"><img src="${imgSrc}" alt=""></div>
              <div class="person-info">
                <div class="title">${title || "åå‰ã‚’å…¥åŠ›"}</div>
                ${tag ? `<div class="tag">${tag}</div>` : ""}
                <div class="desc">${desc || ""}</div>
              </div>
            </div>
            ${b1 ? `<div class="buttons"><div class="btn">${b1}</div></div>` : ""}
          `;
        } else if (type === "image") {
          innerHTML = `
            <div class="image-only">
              <img src="${imgSrc}" alt="">
              ${tag ? `<div class="tag">${tag}</div>` : ""}
              ${b1 ? `<div class="img-btn">${b1}</div>` : ""}
            </div>
          `;
        } else {
          innerHTML = `
            <img src="${imgSrc}" alt="">
            <div class="sample-body">
              ${tag ? `<div class="tag">${tag}</div>` : ""}
              <div class="title">${title || "ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›"}</div>
              <div class="desc">${desc || ""}</div>
              ${price ? `<div class="price">${price}</div>` : ""}
            </div>
            ${b1 ? `<div class="buttons"><div class="btn">${b1}</div></div>` : ""}
          `;
        }

        cardEl.innerHTML = innerHTML;
        wrap.appendChild(cardEl);

        const file = card.querySelector(".cd-image")?.files?.[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => { cardEl.querySelector("img").src = e.target.result; };
          reader.readAsDataURL(file);
        }
      });
    }

    document.addEventListener("change", (e) => {
      if (e.target.closest("#cardsWrap")) updateCardPreview();
    });

    // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ï¼šãƒ›ãƒƒãƒˆã‚¹ãƒãƒƒãƒˆæº–å‚™ï¼†é€ä¿¡ãƒœã‚¿ãƒ³é…ç½®
    window.addEventListener('load', () => {
      initRichmenuHotspots();
      wireInputFocusToHighlight();
      mountLocalActionsToAll();
    });

    // ã€ã‚¹ãƒãƒ›å°‚ç”¨UIã®è¦‹ãŸç›®èª¿æ•´ã€‘
    document.addEventListener('DOMContentLoaded', () => {
      const style = document.createElement('style');
      style.textContent = `
        body{background:#fafafa;padding-bottom:100px;}
        input,textarea,select,button{font-size:16px !important;}
        .local-actions{position:fixed;bottom:0;left:0;right:0;background:#fff;padding:12px;border-top:1px solid #ddd;z-index:50;}
        .local-actions button{width:100%;font-size:17px;padding:14px;background:#06C755;color:#fff;border:none;border-radius:8px;font-weight:600;}
        .local-actions .tip{display:none;}
        label{font-size:15px;}
      `;
      document.head.appendChild(style);
    });
</script>
</body>
</html>
